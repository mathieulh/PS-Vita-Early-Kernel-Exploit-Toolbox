# Kernel Dumper via SceNgsInternal

Simple code to dump kernel memory using a function from the libSceNgsInternal module.

## Usage:

1) Edit the top of `main.c` to suit the firmware of the device.
2) Compile and run the executable via Visual Studio or manually, via Neighborhood.

## Library:

This exploit relies on crafting a library which uses a specific function. See details below: 

Because the vitasdk does not support statically linked executables, it is not possible to use it to build valid executables for PS Vita firmware 2.00 and below, therefore an alternative has to be used. In this case we used the official Sony SDK, this Software Development Kit however only supports a limited amount of libraries. 

Unfortunately one of the function we use in the kdumper code is sceNgsVoiceDefinitionGetPresetInternal (which contains a bug that allows for arbitrary kernel memory read), because this function is not supported by the official sdk, we have to supply our own library. Because we are using stubs however, this is not as simple as starting a new library project, what we did instead was to patch an existing Sony library. 

Because those libraries are the result of patching Sony's original libraries, those are Sony's intellectual property and therefore cannot be shared, I will therefore explain how to patch your own instead:

In order to achieve this specific conditions have to be met:

* Your source library name should not be shorter than the targetted one (ideally it should have the same amount of characters)
* You cannot add or remove bytes to the existing library
* The smaller the source library, the better
* the name of the function you want to use does not have to match the one you set in the library

In this instance, I crafted a libSceNgsInternal library, to do so I have stumbled upon the ideal source library: libScePhotoExport it matches the number of characters for libSceNgsInternal and it's been inside the SDK since at least SDK 0.940 giving me much leeway in using the sceNgsVoiceDefinitionGetPresetInternal function on earlier firmware should I need to do so.

To retrace my steps, you will need to modify both libScePhotoExport_stub.a and libScePhotoExport_stub_weak.a
I patched it doing the following steps: 

* Replacing the function name I want to overwrite in the library with my arbitrarily chosen custom function name (the number of characters have to match), in this instance I replaced all ASCII occurences of scePhotoExportFromFile to sceNgsKernelMemoryRead (which was the function name I have chosen for that particular purpose as well as the one in used by the kdumper code in this repository)

* Replacing the source library name by the targetted library name; in this instance I replaced all ASCII occurences of ScePhotoExport to SceNgsInternal (if you do a broard search, do this after replacing the function name because the function name is composed of the library name!)

* Replacing the ASCII string of NID attached to scePhotoExportFromFile to the one of sceNgsVoiceDefinitionGetPresetInternal 
(to be specific 84fd9fc5 has to be changed to 9ec976f9 in 1.000+), in this instance there should only be one occurence

* Replacing the Hexadecimal value (in little endian) of the NID attached to scePhotoExportFromFile to the one of sceNgsVoiceDefinitionGetPresetInternal 
(To be specific C59FFD84 has to be changed to F976C99E in 1.000+ when using big endian), there should be 3 occurences in the ScePhotoExport Library.

* Replacing the Hexadecimal value (in little endian) of the library NID to the one used by the SceNgsInternal library.
(To be specific D96B1679 has to be changed to 415F82E1 in 1.000+ when using big endian in this instance. (there should be 2 occurences in the ScePhotoExport Library.))

In order to facilitate this process, I have supplied ips patches to apply on 1.000 and 1.600 libScePhotoExport_stub.a and libScePhotoExport_stub_weak.a files respectively inside the ips folder.

## Credits:

Special thanks to mathieulh, LemonHaze, CelesteBlue and Proxima.
